# Makes sense for all European Biobanks
: ${ENABLE_ERIC:=true}

# Makes only sense for German Biobanks
: ${ENABLE_GBN:=false}

FOCUS_RETRY_COUNT=256
PRIVATEKEYFILENAME=/etc/bridgehead/pki/${SITE_ID}.priv.pem

OIDC_USER_GROUP="DKTK_CCP_$(capitalize_first_letter ${SITE_ID})"
OIDC_ADMIN_GROUP="DKTK_CCP_$(capitalize_first_letter ${SITE_ID})_Verwalter"
OIDC_PRIVATE_CLIENT_ID=${SITE_ID}-private
OIDC_PUBLIC_CLIENT_ID=${SITE_ID}-public
# Use "test-realm-01" for testing
OIDC_REALM="${OIDC_REALM:-master}"
OIDC_URL="https://login.verbis.dkfz.de"
OIDC_ISSUER_URL="${OIDC_URL}/realms/${OIDC_REALM}"
OIDC_GROUP_CLAIM="groups"

POSTGRES_TAG=15.6-alpine

for module in $PROJECT/modules/*.sh
do
    log DEBUG "sourcing $module"
    source $module
done

SUPPORT_EMAIL=$ERIC_SUPPORT_EMAIL
BROKER_URL_FOR_PREREQ="${ERIC_BROKER_URL:-$GBN_BROKER_URL}"

if [ -n "$GBN_SUPPORT_EMAIL" ]; then
    SUPPORT_EMAIL=$GBN_SUPPORT_EMAIL
fi

function do_enroll {
    COUNT=0
    if [ "$ENABLE_ERIC" == "true" ]; then
        do_enroll_inner $ERIC_PROXY_ID $ERIC_SUPPORT_EMAIL
        COUNT=$((COUNT+1))
    fi
    if [ "$ENABLE_GBN" == "true" ]; then
        do_enroll_inner $GBN_PROXY_ID $GBN_SUPPORT_EMAIL
        COUNT=$((COUNT+1))
    fi
    if [ $COUNT -ge 2 ]; then
        echo
        echo "You just received $COUNT certificate signing requests (CSR). Please send $COUNT e-mails, with 1 CSR each, to the respective e-mail address."
    fi
}
